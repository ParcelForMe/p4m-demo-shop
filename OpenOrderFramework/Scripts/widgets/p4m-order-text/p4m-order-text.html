<link rel="import" href="../../Lib/polymer/polymer.html" />

<dom-module id="p4m-order-text">

    <template>
        <div id="container">
            Thanks for ordering from us {{consumerData.GivenName}}.
            <template is="dom-if" if="{{cartData.ExpDeliveryDate}}">
                We'll deliver your order to your {{addressTypeStr}} - {{deliveryAddressStr}}{{deliveryDateStr}}.
            </template>
        </div>
    </template>

    <style>

    </style>

    <script>
    //
        Polymer({
            is: "p4m-order-text",

            properties: {
                consumerData: {
                    type: Object
                },
                cartData: {
                    type: Object
                },
                addressTypeStr: {
                    type: String
                },
                deliveryAddressStr: {
                    type: String
                },
                deliveryDateStr: {
                    type: String
                }

            },

            observers: [
                "updateUi(consumerData.*)",
                "updateUi(cartData.*)"
            ],

            ready: function()
            {
                this.updateUi();
            },


            updateUi: function()
            {
                if (this.cartData && this.consumerData) {
                    var deliveryAddr = this._addressById(this.cartData.AddressId);
                    this.deliveryAddressStr = this._addressToStr(deliveryAddr);
                    this.addressTypeStr = this._addressType(deliveryAddr);
                    this.deliveryDateStr = this._expectedDeliveryDateStr(this.cartData.ExpDeliveryDate);
                }
            },

            _addressById: function(id) {
                var foundAddress = null;
                for (var i = 0; i < this.consumerData.Addresses.length; i++) {
                    var address = this.consumerData.Addresses[i];
                    if (address.Id == this.cartData.AddressId) {
                        foundAddress = address;
                        break;
                    }
                }
                return foundAddress;            
            },

            _addressToStr: function (address) {
                if (address) {
                    return address.Street1 + " " + address.Street2 + " in " + (address.City || address.PostCode);
                }
                else {
                    return "";
                }
                
            },

            _addressType: function (address) {
                if (address && address.AddressType) {
                    if (address.AddressType === "Collect") {
                        return "preferred collection point";
                    }
                    else {
                        return "preferred delivery address";
                    }
                }
            },

            _expectedDeliveryDateStr: function (dateStr) {
                if (dateStr) {
                    return " by " + dataStr;
                }
                else {
                    return ". Please select a delivery method to continue";
                }
                
            }

        });
    </script>
</dom-module>
