<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../../Lib/iron-input/iron-input.html" />
<link rel="import" href="../../Lib/iron-icons/iron-icons.html" />
<link rel="import" href="../../Lib/paper-input/paper-input.html" />

<dom-module id="p4m-cart-card">

    <template>
        <p4m-api id="api" ssl="true" host-base-domain="parcelfor.me" host-type="dev" version="v2"></p4m-api>
        <div id="container">
            <div id="image" class="card-panel">
                <img src="{{cartItemData.LinkToImage}}" />
            </div>
            
            <div id="details" class="card-panel">
                <div id="description">{{cartItemData.Desc}}</div>
                <div id="price">{{_priceStr}}</div>
            </div>

            <div id="quantity" class="card-panel">
                <paper-input label="Qty" _is="iron-input" prevent-invalid-input allowed-pattern="[0-9]" type="text" id="qty" bind-value="{{cartItemData.Qty}}" value="{{cartItemData.Qty}}" />
            </div>

            <div id="wishlist" class="card-panel hidden">
                <!-- show a heart icon for wish list -->
                <iron-icon id="wishIcon" class="heart" icon="icons:favorite"></iron-icon>
            </div>

        </div>
        <div id="actions">
            <a href="#" on-tap="remove">Delete</a><span class="divider">|</span>
            <template is="dom-if" if="{{notWish}}">
                <a href="#"><div id="p4mWishBtn" on-click="makeWish">Move to my <span class="p4m-label">Parcel for Me</span> wish list</div></a>
            </template>
            <template is="dom-if" if="{{isWish}}">
                <a href="#"><div id="p4mWishBtn">Moving to wish list...</div></a>
            </template>
            
        </div>
        
    </template>

    <style>
        #container {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;

        }
        #details, #quantity {
            display: flex;
            flex-direction: column;
        }
        #details {
            width: 50%;
        }
        #quantity {
            width: 20%;
        }
        #image {
           width: 30%;
        }
        #image img {
            height: 50px;
            width:auto;
        }

        input#qty {
            width: 90%;
            margin: auto;
        }

        #qty label {
            margin: auto;
        }
        .card-panel {
            padding: 4px;
        }

        #actions {
            width: 80%;
            margin: auto;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }
        .divider {
            margin-left: 4px;
            margin-right:4px;
        }
        .heart {
            animation-name: go-green;
            animation-duration: 0.25s;
            color: rgba(13, 165, 83, 0.8); /*peli icon colour*/
            height: 60px;
            width: 60px;
            margin-top: 0px;
        }

        .heart.explode {
            animation-name: go-explode;
            animation-duration: 0.5s;
            color: white;
        }

        @keyframes go-green {
            from {
                color: white;
                height: 50px;
                width: 50px;
                margin-top: 10px;
            }

            to {
                color: rgba(13, 165, 83, 0.8); /*peli icon colour*/
                height: 60px;
                width: 60px;
                margin-top: 0px;
            }
        }

        @keyframes go-explode {
            from {
                color: rgba(13, 165, 83, 0.8); /*peli icon colour*/
                height: 60px;
                width: 60px;
                margin-top: 0px;
            }

            to {
                color: white;
                height: 100px;
                width: 100px;
                margin-top: -40px;
            }
        }


    </style>

    <script>
    //
        Polymer({
            is: "p4m-cart-card",

            properties: {
                cartItemData: {
                    type: Object,
                    notify: true,
                    observer: "onDataChange"
                },
                currencySymbol: {
                    type: String,
                    value: "£"
                },
                _priceStr: {
                    type: String
                }
            },

            ready: function()
            {
            },

            remove: function() {
                this.set('cartItemData.Qty', 0);
            },

            onDataChange: function (e) {
                this._priceStr = this.currencySymbol + this.cartItemData.Price.toFixed(2);
                this.setWish(false);
            },

            setWish(value) {
                this.isWish = value;
                this.notWish = !this.isWish;
            },

            makeWish: function() {          
                this.showAsWishing();
                this.$.api.call('postWish', {}, this.itemData, () => this.onWishComplete());
                this.remove();
            },

            showAsWishing: function () {
                //Trigger removal from shopping cart   
                this.setWish(true);
                this.$.wishIcon.classList.remove('explode');
                this.$.quantity.classList.add('hidden');
                this.$.wishlist.classList.remove('hidden');
                
            },

            onWishComplete: function (e) {
                this.$.wishIcon.classList.add('explode');
                
            }

        });
    </script>
</dom-module>
