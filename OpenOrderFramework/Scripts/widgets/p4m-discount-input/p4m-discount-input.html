
<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../../Lib/iron-input/iron-input.html" />

<dom-module id="p4m-discount-input">

    <template>
        <div id="content">
            <input is="iron-input" type="text" id="discountCode" bind-value="{{discountCode}}" placeholder="Discount code" />
            <button on-click="sendCode">Apply</button>
        </div>
        <p4m-api id="localApi" is-local="true"></p4m-api>
    </template>

    <script>

        Polymer({
            is: "p4m-discount-input",

            properties: {
                discountCode: {
                    type: String
                },
                cartData: {
                    type: Object
                }
            },
            listeners: {

            },
            ready: function()
            {

            },
            sendCode: function() {
                this.$.localApi.call('applyDiscountCode', { discountCode: this.discountCode }, null, this.onResponse.bind(this));
            },
            onResponse: function (e) {
                if (e.success == false) {
                    this.showError("Invalid discount code");
                }
                else {
                    /*
                    this.set('cartData.Tax', Number(e.tax));
                    this.push('cartData.Discounts',
                     {
                         Description: e.Description,
                         Amount: e.Amount,
                         Code: e.Code
                     });
                     */
                    this.fire('discount', e);
                }
            }

        });
    </script>
</dom-module>