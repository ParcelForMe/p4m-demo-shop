<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../../Lib/iron-collapse/iron-collapse.html" />
<link rel="import" href="../p4m-card/p4m-card.html" />
<link rel="import" href="../p4m-card/p4m-new-card.html" />

<dom-module id="p4m-card-list">

    <template>
        <div id="container">
            <p><a href="#" on-tap="addNewCard">Add a new card</a></p>
            <br />
            <iron-collapse id="newCardCollapse">
                <p4m-new-card consumer-data="{{consumerData}}" new-card-id="{{newCardId}}" card-hash="{{cardHash}}" card-timestamp="{{cardTimestamp}}" card-merchant-id="{{cardMerchantId}}"></p4m-new-card>
            </iron-collapse>
            
            <template is="dom-repeat" items="{{consumerData.PaymentMethods}}" filter="_cardsOnly">
                <p4m-card card-data="{{item}}" on-card-selected="onCardSelected" consumer-data="{{consumerData}}"></p4m-card>
            </template>
        </div>

    </template>

    <style>
        #container {
            display: flex;
            flex-direction: column;
        }
    </style>

    <script>
    //
        Polymer({
            is: "p4m-card-list",

            properties: {
                consumerData: {
                    type: Object,
                    notify: true
                },
                cardHash: {
                    type: String,
                    notify: true
                },
                newCardId: {
                    type: String,
                    notify: true
                },
                cardTimestamp: {
                    type: String,
                    notify: true
                },
                cardMerchantId: {
                    type: String,
                    value: "parcelforme",
                    notify: true
                }
            },

            observers: [

            ],

            ready: function()
            {

            },

            onCardSelected(e) {
                console.log('Selected card', e.detail);
                this.set("consumerData.DefaultPayMethodToken", e.detail.Id); //This should now trigger the other cards to update their UI
            },

            addNewCard: function() {
                this.$.newCardCollapse.toggle();
            },

            _cardsOnly: function (item) {
                return (item && item.AccountType && item.AccountType === "Card");
            }


        });
    </script>
</dom-module>
