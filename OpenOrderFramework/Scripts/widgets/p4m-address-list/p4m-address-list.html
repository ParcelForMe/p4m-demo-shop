<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../../Lib/iron-collapse/iron-collapse.html" />
<link rel="import" href="../p4m-address/p4m-address.html" />

<dom-module id="p4m-address-list">

    <template>
        <div id="container">
            <a href="#" on-tap="toggleNewAddress">Add a new address</a>

            <iron-collapse id="newAddress">
                <p4m-address address-data="{{newAddress}}" consumer-data="{{consumerData}}" mode="edit"></p4m-address>
            </iron-collapse>
            <template is="dom-repeat" items="{{addressListData}}">
                <p4m-address address-data="{{item}}" consumer-data="{{consumerData}}" mode="view" read-only="true"></p4m-address>
            </template>
        </div>

    </template>




    <style>
        #container {
            display: flex;
            flex-direction: column;
        }

    </style>

    <script>
    //
        Polymer({
            is: "p4m-address-list",

            properties: {
                addressListData: {
                    type: Array,
                    notify: true
                    //observer: "onAddressDataChange"
                },
                consumerData: {
                    type: Object,
                    notify: true
                    //observer: "onConsumerDataChange"
                },
                newAddress: {
                    type: Object,
                    value: {},
                    notify: true
                }
            },

            observers: [
                "onAddressDataChange(addressListData.*)",
                "onConsumerPreferredAddressDataChange(consumerData.BillingAddressId)"
            ],

            ready: function()
            {

            },

            toggleNewAddress: function() {
                this.$.newAddress.toggle();
            },

            onAddressDataChange: function (e) {
                console.log("Address list data changed");
            },

            onConsumerPreferredAddressDataChange: function (e) {
                var i = 0;
                console.log("Changed preferred billing address");
                if (this.addressListData) {
                    this.addressListData.forEach((function (item) {
                        this.notifyPath('addressListData.#' + i + "._update", Math.random());
                        i++;
                    }).bind(this));
                }

                //this.notifyPath('addressData', this.addressListData);
            }


        });
    </script>
</dom-module>
