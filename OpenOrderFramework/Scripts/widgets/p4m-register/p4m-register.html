<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../p4m-api/p4m-api.html" />
<link rel="stylesheet" href="../p4m-shared/p4m.css" />

<dom-module id="p4m-register">

    <template>
        <div id="p4mRegisterContainer" class$="{{_topClass}}">        
            <polymer-cookie id="p4mTokenCookie" name="p4mToken"></polymer-cookie>
            <polymer-cookie id="p4mGivenNameCookie" name="p4mGivenName"></polymer-cookie>
            <div style="background: white;" class="corners-5px">
                <div class="corners-top-5px p4m-register-top" style="">
                    <div class="p4m-register-title">Checkout with Parcel For Me</div>
                </div>
                <div class="p4m-register-middle corners-bottom-5px">
                    <template is="dom-if" if="{{_notLoggedIn}}">
                        <div class="p4m-register-explain">
                            <img class="p4m-register-logo" src="./logo-icon.png" id="peli-icon-header" />
                            <div class="p4m-register-text">Purchase faster than ever before and get your parcel first time, every time.</div>
                        </div>
                        <div class="gotham_bookregular mobPaddingPosition">
                            <button type="submit" on-tap="onSignUp" class="p4m-button p4m-button-active p4m-register-button">Sign Up to Parcel For Me</button>
                        </div>
                        <div class="p4m-register-text-link">
                            <a on-click="requestLogin">Sign in</a>
                        </div>
                    </template>
                    <template is="dom-if" if="{{_loggedIn}}">
                        Thanks for using Parcel For Me
                    </template>
                </div>
            </div>
        </div>
    </template>

    <style> 

        #p4mRegisterContainer {
           display: flex;
           flex-direction: column;
           width: 300px;
           padding: 8px;
        }            
      
        .button-container {
            display: flex;
            flex-direction: row;
        }

        .p4m-register-logo {
            height: 50px;
        }

        .p4m-register-title {
            margin:auto;
        }

        .p4m-register-explain {
            display: flex;
            flex-direction: row;
            padding: 8px;
            margin: auto;
        }

        .p4m-register-top {
            display: flex;
            flex-direction: row;
            padding: 8px;
            text-transform: uppercase;
            
        }

        .p4m-register-middle {
            display: flex;
            flex-direction: column;
            background-color:#2aa54f;
            color:#fff;
            padding:10px;
        }

        .p4m-register-text {
            padding-left: 10px;
            padding-right: 5px;
        }

        .p4m-register-text-link {
            display: flex;
            flex-direction: row;
            margin: auto;
            cursor: pointer;
        }

        .p4m-register-text-link a {
            color: white;
        }

        .p4m-button.p4m-register-button {
            background-color: white;
            color: black;
            width: 245px;
        }





    </style>

    <script>
        // All this widget does is provide a btn that allows a consumer to register with P4M
        // clicking the btn will open a popup and load a local call to the server which checks
        // for things like is the user logged in and have they just purchased something.
        // If the user is logged in, the local call redirects to the retailer API which saves the consumer details
        // The user is ultimately redirected to the P4M ID server to complete the registration
        Polymer({
            is: "p4m-register",

            properties: {
                _topClass: {
                    type: String,
                    value: "active"
                },
                _loggedIn: {
                    type: Boolean
                },
                _notLoggedIn: {
                    type: Boolean
                }
            },

            ready: function ()
            {
                this.load();
            },

            load: function () {
                //Check to see if the user is logged in - if so just thank them for using P4M :)
                var token = this.$.p4mTokenCookie.readCookie();
                this._loggedIn = token !== "";
                this._notLoggedIn = !this._loggedIn;
            },

            onSignUp: function (e) {
                // we have a token from PP so now we can launch PP in a popup
                var signupUrl = "//" + window.location.host + "/p4m/signup";
                this.openPopup(signupUrl, "signupWindow", 650, 750);
            },

            requestLogin: function () {
                var event = new CustomEvent('p4m-request-login');
                window.dispatchEvent(event);
            },

            openPopup: function(url, id, w, h) {
                // open the popup
                var left = (screen.width / 2) - (w / 2);
                var top = (screen.height / 2) - (h / 2);
                window.open(url, id, 'toolbar=no, location=no, directories=no, status=no, menubar=yes, copyhistory=no, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);
            },
        });
    </script>
</dom-module>