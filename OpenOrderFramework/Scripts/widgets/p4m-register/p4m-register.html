<link rel="import" href="../../Lib/polymer/polymer.html" />
<link rel="import" href="../p4m-api/p4m-api.html" />
<link rel="stylesheet" href="../p4m-shared/p4m.css" />

<dom-module id="p4m-register">

    <template>
        <div id="p4mRegisterContainer" class$="{{_topClass}}">        
            <polymer-cookie id="p4mTokenCookie" name="p4mToken"></polymer-cookie>
            <polymer-cookie id="p4mGivenNameCookie" name="p4mGivenName"></polymer-cookie>
            <div style="background: white;" class="corners-5px">
                <div class="corners-top-5px" style="">
                    <br>
                    <span class="p4m-widget-registration-subtitle">
                        CHECKOUT WITH<span>
                            <br>
                            <span class="p4m-widget-registration-maintitle">PARCEL FOR ME</span>
                            <img src="./logo-icon.png" id="peli-icon-header"/>
                        </span>
                    </span>
                </div>
                <template is="dom-if" if="{{_notLoggedIn}}">
                    <p class="p4m-widget-registration-title">We support <br> Parcel For Me</p>
                    <p class="p4m-widget-registration-text">Purchase faster than ever before and get your parcel first time, every time.</p>
                    <p style="padding-left: 30px; padding-right: 30px; padding-top: 15px; padding-bottom: 15px; " class="gotham_bookregular mobPaddingPosition">
                        <button type="submit" on-tap="onSignUp" class="button p4m-button corners-5px p4m-register-button p4m-button-active">Sign Up to Parcel For Me</button>
                    </p>
                    <p class="p4m-widget-registration-text-link">
                        Already registered with Parcel For Me? <br>
                        Sign in by clicking the Peli icon above.
                    </p>
                </template>
                <template is="dom-if" if="{{_loggedIn}}">
                    Thanks for using Parcel for Me {{}}
                </template>
            </div>
        </div>
    </template>

    <style> 

        #p4mPurchaseContainer {
            _display: flex;
            _flex-direction: row;
           margin: 10px 18px 10px 18px;
        }            
      
        .button-container {
            display: flex;
            flex-direction: row;
        }

    </style>

    <script>
        // All this widget does is provide a btn that allows a consumer to register with P4M
        // clicking the btn will open a popup and load a local call to the server which checks
        // for things like is the user logged in and have they just purchased something.
        // If the user is logged in, the local call redirects to the retailer API which saves the consumer details
        // The user is ultimately redirected to the P4M ID server to complete the registration
        Polymer({
            is: "p4m-register",

            properties: {
                _topClass: {
                    type: String,
                    value: "active"
                },
                _loggedIn: {
                    type: Boolean
                },
                _notLoggedIn: {
                    type: Boolean
                }
            },

            ready: function ()
            {
                this.load();
            },

            load: function () {
                //Check to see if the user is logged in - if so just thank them for using P4M :)
                var token = this.$.p4mTokenCookie.readCookie();
                this._loggedIn = token !== "";
                this._notLoggedIn = !this._loggedIn;
            },

            onSignUp: function (e) {
                // we have a token from PP so now we can launch PP in a popup
                var signupUrl = "//" + window.location.host + "/p4m/signup";
                this.openPopup(signupUrl, "signupWindow", 650, 750);
            },

            openPopup: function(url, id, w, h) {
                // open the popup
                var left = (screen.width / 2) - (w / 2);
                var top = (screen.height / 2) - (h / 2);
                window.open(url, id, 'toolbar=no, location=no, directories=no, status=no, menubar=yes, copyhistory=no, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);
            },
        });
    </script>
</dom-module>