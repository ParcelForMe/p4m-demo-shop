<link rel="import" href="../../Lib/polymer/polymer.html" />

<dom-module id="p4m-order-summary">

    <template>
        <div id="p4m-container">
            <h2>Order Summary</h2>
            <div class="p4m-table">
                <div class="p4m-row">
                    <div class="p4m-cell header-col">{{_cartItemCount}} items</div>
                    <div class="p4m-cell detail-col">{{_cartDescription}}</div>
                    <div class="p4m-cell cost-col">{{currencySymbol}}{{_cartItemsTotalPriceString}}</div>
                </div>
                <div class="p4m-row">
                    <div class="p4m-cell header-col">Delivery</div>
                    <div class="p4m-cell detail-col">Default delivery</div>
                    <div class="p4m-cell cost-col">$123.00</div>
                </div>
                <div class="p4m-row">
                    <div class="p4m-cell header-col">Discount</div>
                    <div class="p4m-cell detail-col">Early bird special 10%</div>
                    <div class="p4m-cell cost-col">$123.00</div>
                </div>
                <div class="p4m-row">
                    <div class="p4m-cell header-col">Tax</div>
                    <div class="p4m-cell detail-col">10</div>
                    <div class="p4m-cell cost-col">$123.00</div>
                </div>
                <div class="p4m-row">
                    <div class="p4m-cell header-col">Total</div>
                    <div class="p4m-cell detail-col"></div>
                    <div class="p4m-cell cost-col">$123.00</div>
                </div>
            </div>

        </div>
    </template>

    <style>
        #p4m-container {
            width: 90%;
            margin: auto;
        }
        .p4m-table {
            display: flex;
            flex-direction: column;
        }
        .p4m-row {
            display: flex;
            flex-direction: row;
        }
        .p4m-row .header-col {
            color: #404040;
            width: 20%;
        }
        .p4m-row .detail-col {
            width: 60%;
        }
        .p4m-row .cost-col {
            width: 20%;          
        }
        .p4m-row .p4m-cell {
            min-width: 0;
            text-overflow: ellipsis;
            white-space: nowrap;
            overflow: hidden;
        }


        #spinner {
            width: 50px;
            height: 50px;
        }

        .hidden {
            display: none;
        }
    </style>

    <script>
    //
        Polymer({
            is: "p4m-order-summary",

            properties: {
                cartData: {
                    type: Object,
                    notify: true,
                    observer: "onCartDataModified"
                },
                currencySymbol: {
                    type: String,
                    value: '$'
                },
                _cartItemCount: {
                    type: Number,
                    notify: true,
                    value: 0
                },
                _cartItemsTotalPrice: {
                    type: Number,
                    notify: true
                },
                _cartItemsTotalPriceString: {
                    type: String
                },
                _cartDescription: {
                    type: Number,
                    notify: true,
                    value: ''
                }
            },
            observers: [ "onCartDataModified(cartData.Items.*)"],
            ready: function()
            {
                this.update.bind(this)();
            },

            update: function () {
                if (this.cartData) {
                    this._updateItemCount();
                    this._updateCartDescription();
                }               
            },

            _updateItemCount: function() {
                this._cartItemCount = 0;
                this._cartItemsTotalPrice = 0;
                var self = this;
                this.cartData.Items.forEach(function (item) {
                    self._cartItemCount += Number(item.Qty);
                    self._cartItemsTotalPrice += Number(item.Qty) * Number(item.Price);
                });
                self._cartItemsTotalPriceString = self._cartItemsTotalPrice.toFixed(2);
            },

            _updateCartDescription: function() {
                this._cartDescription = null;
                var self = this;
                this.cartData.Items.forEach(function (item) {
                    if (self._cartDescription) {
                        self._cartDescription += ", ";
                    }
                    else self._cartDescription = "";
                    self._cartDescription += item.Desc;
                });
            },


            onCartDataModified: function (e) {
                console.log("p4m-order-summary: onCartDataModified()", e);
                this.update();
            }
        });
    </script>
</dom-module>